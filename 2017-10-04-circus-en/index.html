<!DOCTYPE html>
<!--
  Copyright 2010 Google Inc.

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

     http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.

  Original slides: Marcin Wichary (mwichary@google.com)
  Modifications: Ernest Delgado (ernestd@google.com)
                 Alex Russell (slightlyoff@chromium.org)

  landslide modifications: Adam Zapletal (adamzap@gmail.com)
                           Nicolas Perriault (nperriault@gmail.com)
-->
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Circus, process &amp; socket management</title>
    <!-- Styles -->
    
    <link rel="stylesheet" media="print" href="file:///home/alexis/dev/github.com/landslide/src/landslide/themes/default/css/print.css">
    <link rel="stylesheet" media="screen, projection" href="file:///home/alexis/dev/github.com/slides/circus-en/mozilla/css/screen.css">
    
    
    <!-- /Styles -->
    <!-- Javascripts -->
    
    <script type="text/javascript" src="file:///home/alexis/dev/github.com/landslide/src/landslide/themes/default/js/slides.js"></script>
    
    
    <!-- /Javascripts -->
</head>
<body>
  <div id="blank"></div>
  <div class="presentation">
    <div id="current_presenter_notes">
      <div id="presenter_note"></div>
    </div>
    <div class="slides">
      
      <!-- slide source: slides.rst -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1>Circus, process &amp; socket management</h1></header>
            
            
            <section><img alt="file:///home/alexis/dev/github.com/slides/circus-en/imgs/circus_top.jpg" src="file:///home/alexis/dev/github.com/slides/circus-en/imgs/circus_top.jpg" /></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="slides.rst">slides.rst</a>
            </aside>
            
            <aside class="page_number">
              1/20
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: slides.rst -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1>So what's that?</h1></header>
            
            
            <section><ul class="simple">
<li>Life &amp; Death of processes</li>
<li>respawn them automatically</li>
<li>Stats per process / per service</li>
<li>Centralized service</li>
<li>You can connect from a machine to the other</li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="slides.rst">slides.rst</a>
            </aside>
            
            <aside class="page_number">
              2/20
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: slides.rst -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1>What do we do from that?</h1></header>
            
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="slides.rst">slides.rst</a>
            </aside>
            
            <aside class="page_number">
              3/20
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: slides.rst -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            
            <section><img alt="file:///home/alexis/dev/github.com/slides/circus-en/imgs/tokenserver.png" src="file:///home/alexis/dev/github.com/slides/circus-en/imgs/tokenserver.png" /></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="slides.rst">slides.rst</a>
            </aside>
            
            <aside class="page_number">
              4/20
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: slides.rst -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            
            <section><ul class="simple">
<li>175 crypto processes / machine</li>
<li>Popen… man.</li>
<li>Add / workers on the fly</li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="slides.rst">slides.rst</a>
            </aside>
            
            <aside class="page_number">
              5/20
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: slides.rst -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1>So …</h1></header>
            
            
            <section><ul class="simple">
<li>zmq</li>
<li>possible to deal with it from somewhere else</li>
<li>Real time stats</li>
<li>Stdout / stderr streaming</li>
<li>Easy to extend (you don't need python here)</li>
<li>Handle sockets</li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="slides.rst">slides.rst</a>
            </aside>
            
            <aside class="page_number">
              6/20
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: slides.rst -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1>What is this?</h1></header>
            
            
            <section><pre><span class="k">[watcher:dummy]</span>
<span class="na">cmd</span> <span class="o">=</span> <span class="s">/path/to/executable $(circus.wid)</span>
<span class="na">numprocesses</span> <span class="o">=</span> <span class="s">5</span>

<span class="k">[plugin:flapping]</span>
<span class="na">use</span> <span class="o">=</span> <span class="s">circus.plugins.flapping.Flapping</span>
<span class="na">retry_in</span> <span class="o">=</span> <span class="s">3</span>
<span class="na">max_retry</span> <span class="o">=</span> <span class="s">2</span>
</pre>
<p>→ <cite>circusd myfile.ini</cite></p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="slides.rst">slides.rst</a>
            </aside>
            
            <aside class="page_number">
              7/20
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: slides.rst -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1>Architecture</h1></header>
            
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="slides.rst">slides.rst</a>
            </aside>
            
            <aside class="page_number">
              8/20
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: slides.rst -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            
            <section><img alt="file:///home/alexis/dev/github.com/slides/circus-en/imgs/archi1.png" src="file:///home/alexis/dev/github.com/slides/circus-en/imgs/archi1.png" style="width: 600px;" /></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="slides.rst">slides.rst</a>
            </aside>
            
            <aside class="page_number">
              9/20
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: slides.rst -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            
            <section><img alt="file:///home/alexis/dev/github.com/slides/circus-en/imgs/archi2.png" src="file:///home/alexis/dev/github.com/slides/circus-en/imgs/archi2.png" style="width: 600px;" /></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="slides.rst">slides.rst</a>
            </aside>
            
            <aside class="page_number">
              10/20
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: slides.rst -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            
            <section><img alt="file:///home/alexis/dev/github.com/slides/circus-en/imgs/archi3.png" src="file:///home/alexis/dev/github.com/slides/circus-en/imgs/archi3.png" style="width: 600px;" /></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="slides.rst">slides.rst</a>
            </aside>
            
            <aside class="page_number">
              11/20
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: slides.rst -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1>Socket handling</h1></header>
            
            
            <section><pre><span class="k">[circus]</span>
<span class="na">endpoint</span> <span class="o">=</span> <span class="s">tcp://127.0.0.1:5555</span>
<span class="na">pubsub_endpoint</span> <span class="o">=</span> <span class="s">tcp://127.0.0.1:5556</span>
<span class="na">stats_endpoint</span> <span class="o">=</span> <span class="s">tcp://127.0.0.1:5557</span>

<span class="k">[watcher:web]</span>
<span class="na">cmd</span> <span class="o">=</span> <span class="s">chaussette --fd ${socket:web} server.app</span>
<span class="na">use_sockets</span> <span class="o">=</span> <span class="s">True</span>
<span class="na">numprocesses</span> <span class="o">=</span> <span class="s">5</span>

<span class="k">[socket:web]</span>
<span class="na">host</span> <span class="o">=</span> <span class="s">0.0.0.0</span>
<span class="na">port</span> <span class="o">=</span> <span class="s">8000</span>
</pre>
<ul class="simple">
<li>a shared FD between workers</li>
<li>managemnt at the system level</li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="slides.rst">slides.rst</a>
            </aside>
            
            <aside class="page_number">
              12/20
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: slides.rst -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1>Classical stack</h1></header>
            
            
            <section><img alt="file:///home/alexis/dev/github.com/slides/circus-en/imgs/classical-stack.png" src="file:///home/alexis/dev/github.com/slides/circus-en/imgs/classical-stack.png" style="width: 600px;" /></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="slides.rst">slides.rst</a>
            </aside>
            
            <aside class="page_number">
              13/20
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: slides.rst -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1>Circus Stack</h1></header>
            
            
            <section><img alt="file:///home/alexis/dev/github.com/slides/circus-en/imgs/circus-stack.png" src="file:///home/alexis/dev/github.com/slides/circus-en/imgs/circus-stack.png" style="width: 600px;" /></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="slides.rst">slides.rst</a>
            </aside>
            
            <aside class="page_number">
              14/20
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: slides.rst -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1>Demo ?</h1></header>
            
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="slides.rst">slides.rst</a>
            </aside>
            
            <aside class="page_number">
              15/20
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: slides.rst -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1>How to extend it</h1></header>
            
            
            <section><img alt="file:///home/alexis/dev/github.com/slides/circus-en/imgs/plug.jpg" src="file:///home/alexis/dev/github.com/slides/circus-en/imgs/plug.jpg" style="width: 600px;" /></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="slides.rst">slides.rst</a>
            </aside>
            
            <aside class="page_number">
              16/20
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: slides.rst -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            
            <section><pre><span class="kn">from</span> <span class="nn">circus.plugins</span> <span class="kn">import</span> <span class="n">CircusPlugin</span>


<span class="k">class</span> <span class="nc">Logger</span><span class="p">(</span><span class="n">CircusPlugin</span><span class="p">):</span>

    <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;logger&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Logger</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">handle_init</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;a+&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">handle_stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">handle_recv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="n">topic</span><span class="p">,</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">::</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">topic</span><span class="p">,</span> <span class="n">msg</span><span class="p">))</span>
</pre></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="slides.rst">slides.rst</a>
            </aside>
            
            <aside class="page_number">
              17/20
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: slides.rst -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1>The future?</h1></header>
            
            
            <section><img alt="file:///home/alexis/dev/github.com/slides/circus-en/imgs/party.jpg" src="file:///home/alexis/dev/github.com/slides/circus-en/imgs/party.jpg" /></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="slides.rst">slides.rst</a>
            </aside>
            
            <aside class="page_number">
              18/20
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: slides.rst -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            
            <section><ul class="simple">
<li><strong>0.7</strong> will probably handle clustering?</li>
</ul>
<img alt="file:///home/alexis/dev/github.com/slides/circus-en/imgs/bear.gif" src="file:///home/alexis/dev/github.com/slides/circus-en/imgs/bear.gif" /></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="slides.rst">slides.rst</a>
            </aside>
            
            <aside class="page_number">
              19/20
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: slides.rst -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1>Merci !</h1></header>
            
            
            <section><ul class="simple">
<li><a class="reference external" href="http://circus.io">http://circus.io</a> (doc)</li>
<li><a class="reference external" href="http://github.com/mozilla-services/circus">http://github.com/mozilla-services/circus</a></li>
<li>#mozilla-circus sur irc.freenode.net</li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="slides.rst">slides.rst</a>
            </aside>
            
            <aside class="page_number">
              20/20
            </aside>
          </footer>
        </div>
      </div>
      
    </div>
  </div>
  
  <div id="toc" class="sidebar hidden">
    <h2>Table of Contents</h2>
    <table>
      <caption>Table of Contents</caption>
      
      <tr id="toc-row-1">
        <th><a href="#slide1">Circus, process &amp; socket management</a></th>
        <td><a href="#slide1">1</a></td>
      </tr>
      
      
      <tr id="toc-row-2">
        <th><a href="#slide2">So what's that?</a></th>
        <td><a href="#slide2">2</a></td>
      </tr>
      
      
      <tr id="toc-row-3">
        <th><a href="#slide3">What do we do from that?</a></th>
        <td><a href="#slide3">3</a></td>
      </tr>
      
      
      <tr id="toc-row-4">
        <th><a href="#slide4">-</a></th>
        <td><a href="#slide4">4</a></td>
      </tr>
      
      
      <tr id="toc-row-5">
        <th><a href="#slide5">-</a></th>
        <td><a href="#slide5">5</a></td>
      </tr>
      
      
      <tr id="toc-row-6">
        <th><a href="#slide6">So …</a></th>
        <td><a href="#slide6">6</a></td>
      </tr>
      
      
      <tr id="toc-row-7">
        <th><a href="#slide7">What is this?</a></th>
        <td><a href="#slide7">7</a></td>
      </tr>
      
      
      <tr id="toc-row-8">
        <th><a href="#slide8">Architecture</a></th>
        <td><a href="#slide8">8</a></td>
      </tr>
      
      
      <tr id="toc-row-9">
        <th><a href="#slide9">-</a></th>
        <td><a href="#slide9">9</a></td>
      </tr>
      
      
      <tr id="toc-row-10">
        <th><a href="#slide10">-</a></th>
        <td><a href="#slide10">10</a></td>
      </tr>
      
      
      <tr id="toc-row-11">
        <th><a href="#slide11">-</a></th>
        <td><a href="#slide11">11</a></td>
      </tr>
      
      
      <tr id="toc-row-12">
        <th><a href="#slide12">Socket handling</a></th>
        <td><a href="#slide12">12</a></td>
      </tr>
      
      
      <tr id="toc-row-13">
        <th><a href="#slide13">Classical stack</a></th>
        <td><a href="#slide13">13</a></td>
      </tr>
      
      
      <tr id="toc-row-14">
        <th><a href="#slide14">Circus Stack</a></th>
        <td><a href="#slide14">14</a></td>
      </tr>
      
      
      <tr id="toc-row-15">
        <th><a href="#slide15">Demo ?</a></th>
        <td><a href="#slide15">15</a></td>
      </tr>
      
      
      <tr id="toc-row-16">
        <th><a href="#slide16">How to extend it</a></th>
        <td><a href="#slide16">16</a></td>
      </tr>
      
      
      <tr id="toc-row-17">
        <th><a href="#slide17">-</a></th>
        <td><a href="#slide17">17</a></td>
      </tr>
      
      
      <tr id="toc-row-18">
        <th><a href="#slide18">The future?</a></th>
        <td><a href="#slide18">18</a></td>
      </tr>
      
      
      <tr id="toc-row-19">
        <th><a href="#slide19">-</a></th>
        <td><a href="#slide19">19</a></td>
      </tr>
      
      
      <tr id="toc-row-20">
        <th><a href="#slide20">Merci !</a></th>
        <td><a href="#slide20">20</a></td>
      </tr>
      
      
    </table>
  </div>
  
  <div id="help" class="sidebar hidden">
    <h2>Help</h2>
    <table>
      <caption>Help</caption>
      <tr>
        <th>Table of Contents</th>
        <td>t</td>
      </tr>
      <tr>
        <th>Exposé</th>
        <td>ESC</td>
      </tr>
      <tr>
        <th>Full screen slides</th>
        <td>e</td>
      </tr>
      <tr>
        <th>Presenter View</th>
        <td>p</td>
      </tr>
      <tr>
        <th>Source Files</th>
        <td>s</td>
      </tr>
      <tr>
        <th>Slide Numbers</th>
        <td>n</td>
      </tr>
      <tr>
        <th>Toggle screen blanking</th>
        <td>b</td>
      </tr>
      <tr>
        <th>Show/hide slide context</th>
        <td>c</td>
      </tr>
      <tr>
        <th>Notes</th>
        <td>2</td>
      </tr>
      <tr>
        <th>Help</th>
        <td>h</td>
      </tr>
    </table>
  </div>
  <script>main()</script>
</body>
</html>